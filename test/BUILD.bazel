load(
    "//ign_bazel:cmake_configure_file.bzl",
    "cmake_configure_file",
)

load(
    "//ign_bazel:build_defs.bzl",
    "IGNITION_ROOT",
)

BINARY_DIR = "./ign_gazebo"

SOURCE_DIR = "./ign_gazebo"

# Generates config.hh based on the version numbers in CMake code.
cmake_configure_file(
    name = "test_config",
    src = "test_config.hh.in",
    out = "ignition/gazebo/test_config.hh",
    cmakelists = ["CMakeLists.txt"],
    defines = [
        "PROJECT_BINARY_DIR=%s" % BINARY_DIR,
        "PROJECT_SOURCE_DIR=%s" % SOURCE_DIR,
    ],
    visibility = ["//visibility:private"],
)

cc_library(
    name = "test_utils",
    hdrs = [
        "ignition/gazebo/test_config.hh",
        "helpers/EnvTestFixture.hh",
        "helpers/Relay.hh",
        "helpers/UniqueTestDirectoryEnv.hh",
        "plugins/MockSystem.hh",
    ],
    includes = ["."],
    visibility = ["//visibility:public"],
)

cc_binary(
    name = "libMockSystem.so",
    srcs = ["plugins/MockSystem.cc"], 
    deps = [
        ":test_utils",
        IGNITION_ROOT + "ign_common",
        IGNITION_ROOT + "ign_common/events",
        IGNITION_ROOT + "ign_gazebo:ign_gazebo_headers",
        IGNITION_ROOT + "ign_msgs",
        IGNITION_ROOT + "ign_plugin/register",
        IGNITION_ROOT + "sdformat",
    ],
    includes = ["plugins"],
    linkshared = 1,
)

"""
cc_test(
    name = "INTEGRATION_ackermann_steering_system",
    srcs = ["integration/ackermann_steering_system.cc"],
    data = [
        "worlds/ackermann_steering.sdf",
        "worlds/ackermann_steering_custom_frame_id.sdf",
        "worlds/ackermann_steering_custom_topics.sdf",
        "worlds/ackermann_steering_limited_joints_pub.sdf",
        "worlds/ackermann_steering_slow_odom.sdf",
        ":libMockSystem.so",
        IGNITION_ROOT + "ign_physics/dartsim:libignition-physics-dartsim-plugin.so",
        IGNITION_ROOT + "ign_gazebo/src/systems:libignition-gazebo-ackermann-steering-system.so",
        IGNITION_ROOT + "ign_gazebo/src/systems:libignition-gazebo-physics-system.so",
        IGNITION_ROOT + "ign_gazebo/src/systems:libignition-gazebo-scene-broadcaster-system.so",
        IGNITION_ROOT + "ign_gazebo/src/systems:libignition-gazebo-user-commands-system.so",
    ],
    deps = [
        ":test_utils",
        IGNITION_ROOT + "ign_gazebo",
        "@gtest",
        "@gtest//:gtest_main",
    ],
)
"""


exports_files(["data"])

